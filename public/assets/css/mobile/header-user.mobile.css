/* Header User – Mobile only (desktop invariato) */
@media (max-width:768px){

  :root{
    --mblu-z: 70;
  }

  /* Barra mobile "shell" (logo sx, hamburger dx) */
  #mblu-bar{
    position: sticky; top: 0; z-index: var(--mblu-z);
    display: flex; align-items: center; justify-content: space-between;
    min-height: 56px; padding: 8px 12px;
    background: var(--c-bg, #0b1220);
    border-bottom: 1px solid var(--c-border, rgba(255,255,255,.08));
  }
  #mblu-brand{ display:flex; align-items:center; gap:10px; color:#fff; text-decoration:none; }
  #mblu-brand img{ display:block; width:40px; height:40px; }

  #mblu-right{ display:flex; align-items:center; gap:8px; }

  /* (Opzionale) chip avatar/username a destra – usati solo se disponibili */
  #mblu-usrChip{ display:flex; align-items:center; gap:8px; }
  #mblu-usrAv{
    display:inline-flex; align-items:center; justify-content:center;
    width:32px; height:32px; border-radius:9999px;
    border:1px solid var(--c-border,#20314b);
    background:var(--c-bg-2,#0f172a); color:var(--c-text,#fff);
    font-weight:900; overflow:hidden;
  }
  #mblu-usrAv img{ width:100%; height:100%; object-fit:cover; display:block; }

  /* Bottone Messaggi (rotondo, prima dell'avatar) */
  #mblu-msgBtn{
    display:inline-flex; align-items:center; justify-content:center;
    width:42px; height:42px; border-radius:9999px;
    border:1px solid var(--c-border,#1e293b);
    background:var(--c-bg-2,#0f172a); color:var(--c-text,#fff);
    -webkit-tap-highlight-color:transparent;
  }
  #mblu-msgBtn svg{ width:20px; height:20px; }

  /* Hamburger rotondo a destra */
  #mblu-btn{
    display:inline-flex; align-items:center; justify-content:center;
    width:42px; height:42px; border-radius:9999px;
    border:1px solid var(--c-border,#1e293b);
    background:var(--c-bg-2,#0f172a); color:var(--c-text,#fff);
    -webkit-tap-highlight-color:transparent;
  }
  #mblu-btn svg{ width:22px; height:22px; }

  /* Backdrop + Drawer */
  #mblu-backdrop{
    position:fixed; inset:0; z-index:calc(var(--mblu-z) + 10);
    background:rgba(0,0,0,.45); backdrop-filter:saturate(120%) blur(1px);
    opacity:0; pointer-events:none; transition:opacity .2s ease;
  }
  #mblu-backdrop.mbl-open{ opacity:1; pointer-events:auto; }

  #mblu-drawer{
    position:fixed; top:0; right:0; height:100dvh; z-index:calc(var(--mblu-z) + 20);
    width:320px; max-width:92vw;
    transform:translateX(105%); transition:transform .24s ease;
    background:var(--c-bg,#0b1220); color:var(--c-text,#fff);
    border-left:1px solid var(--c-border,rgba(255,255,255,.08));
    display:flex; flex-direction:column;
  }
  #mblu-drawer.mbl-open{ transform:translateX(0); }

  /* Head drawer + X rotonda */
  #mblu-drawer .mbl-head{
    display:flex; align-items:center; gap:12px; padding:14px;
    border-bottom:1px solid var(--c-border,rgba(255,255,255,.08));
  }
  #mblu-drawer .mbl-title{ font-weight:900; font-size:16px; }
  #mblu-drawer .mbl-close{
    margin-left:auto; width:42px; height:42px; border-radius:9999px;
    border:1px solid var(--c-border,rgba(255,255,255,.12));
    background:var(--c-bg-2,#0f172a); color:var(--c-text,#fff);
    display:inline-flex; align-items:center; justify-content:center;
  }
  #mblu-drawer .mbl-close svg{ width:22px; height:22px; }

  #mblu-drawer .mbl-scroll{ flex:1; overflow:auto; }
  #mblu-drawer .mbl-sec{ padding:12px 12px 6px; }
  #mblu-drawer .mbl-sec__title{
    font-size:12px; font-weight:900; text-transform:uppercase; letter-spacing:.3px;
    color:var(--c-muted,#9fb7ff); padding:2px 6px 8px;
  }

  /* Liste link */
  #mblu-drawer .mbl-list{ list-style:none; margin:0; padding:0; }
  #mblu-drawer .mbl-list li{ margin:0; }
  #mblu-drawer .mbl-list a{
    display:block; padding:12px 8px; border-radius:8px;
    color:var(--c-text,#e5e7eb); text-decoration:none; font-weight:800;
  }

  /* KV rows + refresh compatto vicino al saldo */
  #mblu-drawer .mbl-kv{ display:flex; align-items:center; gap:8px; padding:8px 2px; }
  #mblu-drawer .mbl-kv .k{ min-width:110px; color:var(--c-muted,#9fb7ff); font-weight:900; }
  #mblu-drawer .mbl-kv .v{ font-weight:900; font-size:16px; }
  #mblu-refresh{
    display:inline-flex; align-items:center; justify-content:center;
    width:28px; height:28px; border-radius:9999px; margin-left:6px;
    border:1px solid var(--c-border,rgba(255,255,255,.12));
    background:var(--c-bg-2,#0f172a); color:var(--c-text,#fff);
  }
  #mblu-refresh svg{ width:16px; height:16px; }

  /* CTA uguali */
  #mblu-drawer .mbl-ctaRow{ display:flex; gap:8px; padding:8px 6px 0; flex-wrap:wrap; }
  #mblu-drawer .mbl-cta,
  #mblu-drawer .mbl-ghost{
    display:inline-flex; align-items:center; justify-content:center;
    height:40px; padding:0 16px; border-radius:9999px; font-weight:800; white-space:nowrap;
  }
  #mblu-drawer .mbl-cta{
    background:var(--c-primary,#3b82f6); color:#fff;
    border:1px solid color-mix(in lab, var(--c-primary,#3b82f6) 85%, #000);
  }
  #mblu-drawer .mbl-ghost{
    background:transparent; color:var(--c-text,#e5e7eb);
    border:1px solid var(--c-border,#1f2937);
  }

  /* Lock scroll quando aperto */
  html.mbl-lock, body.mbl-lock{ overflow:hidden !important; }
}

@media (min-width:769px){
  #mblu-bar, #mblu-backdrop, #mblu-drawer{ display:none !important; }
}
/* — Messaggi in header (rotondo), mostrato prima dell'avatar — */
@media (max-width:768px){
  #mblu-msgBtn{
    display:inline-flex; align-items:center; justify-content:center;
    width:42px; height:42px; border-radius:9999px;
    border:1px solid var(--c-border,#1e293b);
    background:var(--c-bg-2,#0f172a); color:var(--c-text,#fff);
    -webkit-tap-highlight-color:transparent;
  }
  #mblu-msgBtn svg, #mblu-msgBtn i{ width:20px; height:20px; display:block; }
}
/* === TWEAK MESSAGGI: MOBILE ONLY ==================================== */
@media (max-width: 768px) {
  /* 1) Bottone messaggi: stessa misura dell'avatar e leggermente più a sinistra */
  #mblu-right #msgw-user { 
    display: inline-flex; 
    align-items: center; 
  }

  /* Dimensione avatar tipica 38–40px: tieni allineato qui. Se il tuo avatar è 40px,
     puoi portare questi valori a 40px. */
  #mblu-right #msgw-user .msgw-btn {
    width: 38px;
    height: 38px;
    border-radius: 9999px;
    background: var(--c-bg-2, #0f172a);
    border: 1px solid var(--c-border, rgba(255,255,255,.14));
    /* più “a sinistra” = stacco maggiore dall’avatar */
    margin-right: 10px;
  }
  #mblu-right #msgw-user .msgw-btn svg { width: 18px; height: 18px; }
  #mblu-right #msgw-user .msgw-dot { top: -2px; right: -2px; }

  /* 2) Pannello messaggi: centrato e non tagliato (fixed + safe-area) */
  /* NB: forzo il posizionamento solo in mobile, lasciando intatto il desktop. */
  #mblu-right #msgwPanel,
  #msgwPanel {
    position: fixed !important;
    left: 50% !important;
    right: auto !important;
    transform: translateX(-50%);
    top: calc(env(safe-area-inset-top, 0px) + 64px); /* sotto la status bar/notch */
    width: min(360px, 90vw) !important;  /* più compatto e sempre dentro viewport */
    max-height: 70vh;
    z-index: 10010 !important;          /* sopra header/drawer */
  }

  /* Evita qualsiasi clipping dal container dell'header */
  #mblu-bar { overflow: visible; }
  #mblu-right, #msgw-user { transform: none !important; }
}
/* === END TWEAK MESSAGGI ============================================= */
#mblu-right #msgw-user .msgw-btn { width: 40px; height: 40px; }
